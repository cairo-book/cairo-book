<!DOCTYPE HTML>
<html lang="id" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Inlining in Cairo - The Cairo Programming Language</title>


    <!-- Custom HTML head -->

    <meta name="description" content="The Cairo Programming Language. A comprehensive documentation for Cairo, the smart contract language for Starknet.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
    <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="theme/css/last-changed.css">
    <link rel="stylesheet" href="theme/css/chat.css">
    <link rel="stylesheet" href="theme/css/version-switcher.css">

    <!-- MathJax -->
    <script async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <link rel="canonical" id="canonical-link" href="" />
    <script>
        (function () {
            var path = "ch12-06-inlining-in-cairo.md";
            var canonicalPath;

            // Special handling for different cases
            if (path === "" || path === "index.md") {
                // Homepage should not have index.html
                canonicalPath = "";
            } else {
                // Other pages: replace .md with .html
                canonicalPath = path.replace(/\.md$/, ".html");
            }

            var canonicalUrl = "https://www.starknet.io/cairo-book/" + canonicalPath;

            // Remove trailing slash if present (except for root)
            if (canonicalUrl.endsWith("/") && canonicalUrl !== "https://www.starknet.io/cairo-book/") {
                canonicalUrl = canonicalUrl.slice(0, -1);
            }

            document.getElementById("canonical-link").href = canonicalUrl;
        })();
    </script>

    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-M6M97KJP');</script>
    <!-- End Google Tag Manager -->
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M6M97KJP" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-0ZJLBV4KE2"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());

            gtag('config', 'G-0ZJLBV4KE2'); // lfg
            gtag('config', 'G-WY42TERK5P') // starknet
            gtag('config', 'G-1CHRL0BVJC'); // pers
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title-page.html">The Cairo Book</a></li><li class="chapter-item expanded affix "><a href="ch00-01-foreword.html">Foreword</a></li><li class="chapter-item expanded affix "><a href="ch00-00-introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">The Cairo Programming Language</li><li class="chapter-item expanded "><a href="ch01-00-getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch01-01-installation.html"><strong aria-hidden="true">1.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="ch01-02-hello-world.html"><strong aria-hidden="true">1.2.</strong> Hello, World!</a></li><li class="chapter-item expanded "><a href="ch01-03-proving-a-prime-number.html"><strong aria-hidden="true">1.3.</strong> Proving That A Number Is Prime</a></li></ol></li><li class="chapter-item expanded "><a href="ch02-00-common-programming-concepts.html"><strong aria-hidden="true">2.</strong> Common Programming Concepts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch02-01-variables-and-mutability.html"><strong aria-hidden="true">2.1.</strong> Variables and Mutability</a></li><li class="chapter-item expanded "><a href="ch02-02-data-types.html"><strong aria-hidden="true">2.2.</strong> Data Types</a></li><li class="chapter-item expanded "><a href="ch02-03-functions.html"><strong aria-hidden="true">2.3.</strong> Functions</a></li><li class="chapter-item expanded "><a href="ch02-04-comments.html"><strong aria-hidden="true">2.4.</strong> Comments</a></li><li class="chapter-item expanded "><a href="ch02-05-control-flow.html"><strong aria-hidden="true">2.5.</strong> Control Flow</a></li></ol></li><li class="chapter-item expanded "><a href="ch03-00-common-collections.html"><strong aria-hidden="true">3.</strong> Common Collections</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch03-01-arrays.html"><strong aria-hidden="true">3.1.</strong> Arrays</a></li><li class="chapter-item expanded "><a href="ch03-02-dictionaries.html"><strong aria-hidden="true">3.2.</strong> Dictionaries</a></li></ol></li><li class="chapter-item expanded "><a href="ch04-00-understanding-ownership.html"><strong aria-hidden="true">4.</strong> Understanding Ownership</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch04-01-what-is-ownership.html"><strong aria-hidden="true">4.1.</strong> What is Ownership?</a></li><li class="chapter-item expanded "><a href="ch04-02-references-and-snapshots.html"><strong aria-hidden="true">4.2.</strong> References and Snapshots</a></li></ol></li><li class="chapter-item expanded "><a href="ch05-00-using-structs-to-structure-related-data.html"><strong aria-hidden="true">5.</strong> Using Structs to Structure Related Data</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch05-01-defining-and-instantiating-structs.html"><strong aria-hidden="true">5.1.</strong> Defining and Instantiating Structs</a></li><li class="chapter-item expanded "><a href="ch05-02-an-example-program-using-structs.html"><strong aria-hidden="true">5.2.</strong> An Example Program Using Structs</a></li><li class="chapter-item expanded "><a href="ch05-03-method-syntax.html"><strong aria-hidden="true">5.3.</strong> Method Syntax</a></li></ol></li><li class="chapter-item expanded "><a href="ch06-00-enums-and-pattern-matching.html"><strong aria-hidden="true">6.</strong> Enums and Pattern Matching</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch06-01-enums.html"><strong aria-hidden="true">6.1.</strong> Enums</a></li><li class="chapter-item expanded "><a href="ch06-02-the-match-control-flow-construct.html"><strong aria-hidden="true">6.2.</strong> The Match Control Flow Construct</a></li><li class="chapter-item expanded "><a href="ch06-03-concise-control-flow-with-if-let-and-while-let.html"><strong aria-hidden="true">6.3.</strong> Concise Control Flow with if let and while let</a></li></ol></li><li class="chapter-item expanded "><a href="ch07-00-managing-cairo-projects-with-packages-crates-and-modules.html"><strong aria-hidden="true">7.</strong> Managing Cairo Projects with Packages, Crates and Modules</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch07-01-packages-and-crates.html"><strong aria-hidden="true">7.1.</strong> Packages and Crates</a></li><li class="chapter-item expanded "><a href="ch07-02-defining-modules-to-control-scope.html"><strong aria-hidden="true">7.2.</strong> Defining Modules to Control Scope</a></li><li class="chapter-item expanded "><a href="ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html"><strong aria-hidden="true">7.3.</strong> Paths for Referring to an Item in the Module Tree</a></li><li class="chapter-item expanded "><a href="ch07-04-bringing-paths-into-scope-with-the-use-keyword.html"><strong aria-hidden="true">7.4.</strong> Bringing Paths into Scope with the use Keyword</a></li><li class="chapter-item expanded "><a href="ch07-05-separating-modules-into-different-files.html"><strong aria-hidden="true">7.5.</strong> Separating Modules into Different Files</a></li></ol></li><li class="chapter-item expanded "><a href="ch08-00-generic-types-and-traits.html"><strong aria-hidden="true">8.</strong> Generic Types and Traits</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch08-01-generic-data-types.html"><strong aria-hidden="true">8.1.</strong> Generic Data Types</a></li><li class="chapter-item expanded "><a href="ch08-02-traits-in-cairo.html"><strong aria-hidden="true">8.2.</strong> Traits in Cairo</a></li></ol></li><li class="chapter-item expanded "><a href="ch09-00-error-handling.html"><strong aria-hidden="true">9.</strong> Error Handling</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch09-01-unrecoverable-errors-with-panic.html"><strong aria-hidden="true">9.1.</strong> Unrecoverable Errors with panic</a></li><li class="chapter-item expanded "><a href="ch09-02-recoverable-errors.html"><strong aria-hidden="true">9.2.</strong> Recoverable Errors with Result</a></li></ol></li><li class="chapter-item expanded "><a href="ch10-00-testing-cairo-programs.html"><strong aria-hidden="true">10.</strong> Testing Cairo Programs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch10-01-how-to-write-tests.html"><strong aria-hidden="true">10.1.</strong> How To Write Tests</a></li><li class="chapter-item expanded "><a href="ch10-02-test-organization.html"><strong aria-hidden="true">10.2.</strong> Test Organization</a></li></ol></li><li class="chapter-item expanded "><a href="ch11-00-functional-features.html"><strong aria-hidden="true">11.</strong> Functional Language Features: Iterators and Closures</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch11-01-closures.html"><strong aria-hidden="true">11.1.</strong> Closures: Anonymous Functions that Capture Their Environment</a></li></ol></li><li class="chapter-item expanded "><a href="ch12-00-advanced-features.html"><strong aria-hidden="true">12.</strong> Advanced Cairo Features</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch12-01-custom-data-structures.html"><strong aria-hidden="true">12.1.</strong> Custom Data Structures</a></li><li class="chapter-item expanded "><a href="ch12-02-smart-pointers.html"><strong aria-hidden="true">12.2.</strong> Smart Pointers</a></li><li class="chapter-item expanded "><a href="ch12-09-deref-coercion.html"><strong aria-hidden="true">12.3.</strong> Deref Coercion</a></li><li class="chapter-item expanded "><a href="ch12-10-associated-items.html"><strong aria-hidden="true">12.4.</strong> Associated Items</a></li><li class="chapter-item expanded "><a href="ch12-03-operator-overloading.html"><strong aria-hidden="true">12.5.</strong> Operator Overloading</a></li><li class="chapter-item expanded "><a href="ch12-04-hash.html"><strong aria-hidden="true">12.6.</strong> Working with Hashes</a></li><li class="chapter-item expanded "><a href="ch12-05-macros.html"><strong aria-hidden="true">12.7.</strong> Macros</a></li><li class="chapter-item expanded "><a href="ch12-10-procedural-macros.html"><strong aria-hidden="true">12.8.</strong> Procedural Macros</a></li><li class="chapter-item expanded "><a href="ch12-06-inlining-in-cairo.html"><strong aria-hidden="true">12.9.</strong> Inlining in Cairo</a></li><li class="chapter-item expanded "><a href="ch12-08-printing.html"><strong aria-hidden="true">12.10.</strong> Printing</a></li><li class="chapter-item expanded "><a href="ch12-10-arithmetic-circuits.html"><strong aria-hidden="true">12.11.</strong> Arithmetic Circuits</a></li><li class="chapter-item expanded "><a href="ch12-11-offloading-computations-with-oracles.html"><strong aria-hidden="true">12.12.</strong> Offloading Computations with Oracles</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-00.html"><strong aria-hidden="true">13.</strong> Appendix (Cairo)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-01-keywords.html"><strong aria-hidden="true">13.1.</strong> A - Keywords</a></li><li class="chapter-item expanded "><a href="appendix-02-operators-and-symbols.html"><strong aria-hidden="true">13.2.</strong> B - Operators and Symbols</a></li><li class="chapter-item expanded "><a href="appendix-03-derivable-traits.html"><strong aria-hidden="true">13.3.</strong> C - Derivable Traits</a></li><li class="chapter-item expanded "><a href="appendix-04-cairo-prelude.html"><strong aria-hidden="true">13.4.</strong> D - The Cairo Prelude</a></li><li class="chapter-item expanded "><a href="appendix-05-common-error-messages.html"><strong aria-hidden="true">13.5.</strong> E - Common Error Messages</a></li><li class="chapter-item expanded "><a href="appendix-06-useful-development-tools.html"><strong aria-hidden="true">13.6.</strong> F - Useful Development Tools</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Smart Contracts in Cairo</li><li class="chapter-item expanded "><a href="ch100-00-introduction-to-smart-contracts.html"><strong aria-hidden="true">14.</strong> Introduction to Smart Contracts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch100-01-contracts-classes-and-instances.html"><strong aria-hidden="true">14.1.</strong> Starknet contract classes and instances</a></li></ol></li><li class="chapter-item expanded "><a href="ch101-00-building-starknet-smart-contracts.html"><strong aria-hidden="true">15.</strong> Building Starknet Smart Contracts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch101-01-starknet-types.html"><strong aria-hidden="true">15.1.</strong> Starknet Types</a></li><li class="chapter-item expanded "><a href="ch101-01-00-contract-storage.html"><strong aria-hidden="true">15.2.</strong> Contract Storage</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch101-01-01-storage-mappings.html"><strong aria-hidden="true">15.2.1.</strong> Storage Mappings</a></li><li class="chapter-item "><a href="ch101-01-02-storage-vecs.html"><strong aria-hidden="true">15.2.2.</strong> Storage Vecs</a></li></ol></li><li class="chapter-item expanded "><a href="ch101-02-contract-functions.html"><strong aria-hidden="true">15.3.</strong> Contract Functions</a></li><li class="chapter-item expanded "><a href="ch101-03-contract-events.html"><strong aria-hidden="true">15.4.</strong> Contract Events</a></li></ol></li><li class="chapter-item expanded "><a href="ch102-00-starknet-contract-interactions.html"><strong aria-hidden="true">16.</strong> Starknet Contract Interactions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch102-01-contract-class-abi.html"><strong aria-hidden="true">16.1.</strong> Contract Class ABI</a></li><li class="chapter-item expanded "><a href="ch102-02-interacting-with-another-contract.html"><strong aria-hidden="true">16.2.</strong> Interacting with Another Contract</a></li><li class="chapter-item expanded "><a href="ch102-03-executing-code-from-another-class.html"><strong aria-hidden="true">16.3.</strong> Executing Code from Another Class</a></li><li class="chapter-item expanded "><a href="ch102-04-serialization-of-cairo-types.html"><strong aria-hidden="true">16.4.</strong> Serialization of Cairo types</a></li></ol></li><li class="chapter-item expanded "><a href="ch103-00-building-advanced-starknet-smart-contracts.html"><strong aria-hidden="true">17.</strong> Building Advanced Starknet Smart Contracts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch103-01-optimizing-storage-costs.html"><strong aria-hidden="true">17.1.</strong> Optimizing Storage Costs</a></li><li class="chapter-item expanded "><a href="ch103-02-00-composability-and-components.html"><strong aria-hidden="true">17.2.</strong> Composability and Components</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch103-02-01-under-the-hood.html"><strong aria-hidden="true">17.2.1.</strong> Under the Hood</a></li><li class="chapter-item "><a href="ch103-02-02-component-dependencies.html"><strong aria-hidden="true">17.2.2.</strong> Component Dependencies</a></li><li class="chapter-item "><a href="ch103-02-03-testing-components.html"><strong aria-hidden="true">17.2.3.</strong> Testing Components</a></li></ol></li><li class="chapter-item expanded "><a href="ch103-03-upgradeability.html"><strong aria-hidden="true">17.3.</strong> Upgradeability</a></li><li class="chapter-item expanded "><a href="ch103-04-L1-L2-messaging.html"><strong aria-hidden="true">17.4.</strong> L1 &lt;&gt; L2 Messaging</a></li><li class="chapter-item expanded "><a href="ch103-05-oracle-interactions.html"><strong aria-hidden="true">17.5.</strong> Oracle Interactions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch103-05-01-price-feeds.html"><strong aria-hidden="true">17.5.1.</strong> Price Feeds</a></li><li class="chapter-item "><a href="ch103-05-02-randomness.html"><strong aria-hidden="true">17.5.2.</strong> Randomness</a></li></ol></li><li class="chapter-item expanded "><a href="ch103-06-00-other-examples.html"><strong aria-hidden="true">17.6.</strong> Other Examples</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch103-06-01-deploying-and-interacting-with-a-voting-contract.html"><strong aria-hidden="true">17.6.1.</strong> Deploying and Interacting with a Voting Contract</a></li><li class="chapter-item "><a href="ch103-06-02-working-with-erc20-token.html"><strong aria-hidden="true">17.6.2.</strong> Working with ERC20 Token</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="ch104-00-starknet-smart-contracts-security.html"><strong aria-hidden="true">18.</strong> Starknet Smart Contracts Security</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch104-01-general-recommendations.html"><strong aria-hidden="true">18.1.</strong> General Recommendations</a></li><li class="chapter-item expanded "><a href="ch104-02-testing-smart-contracts.html"><strong aria-hidden="true">18.2.</strong> Testing Smart Contracts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch104-02-01-unit-testing.html"><strong aria-hidden="true">18.2.1.</strong> Unit Testing</a></li><li class="chapter-item "><a href="ch104-02-02-integration-testing.html"><strong aria-hidden="true">18.2.2.</strong> Integration Testing</a></li><li class="chapter-item "><a href="ch104-02-03-fuzz-testing.html"><strong aria-hidden="true">18.2.3.</strong> Property-Based Testing</a></li><li class="chapter-item "><a href="ch104-02-04-fork-testing.html"><strong aria-hidden="true">18.2.4.</strong> Fork Testing</a></li></ol></li><li class="chapter-item expanded "><a href="ch104-03-static-analysis-tools.html"><strong aria-hidden="true">18.3.</strong> Static Analysis Tools</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-000.html"><strong aria-hidden="true">19.</strong> Appendix (Starknet)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-08-system-calls.html"><strong aria-hidden="true">19.1.</strong> A - System Calls</a></li><li class="chapter-item expanded "><a href="appendix-09-sierra.html"><strong aria-hidden="true">19.2.</strong> B - Sierra</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Cairo VM</li><li class="chapter-item expanded "><a href="ch200-introduction.html"><strong aria-hidden="true">20.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="ch201-architecture.html"><strong aria-hidden="true">21.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="ch202-00-memory.html"><strong aria-hidden="true">22.</strong> Memory</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch202-01-non-deterministic-read-only-memory.html"><strong aria-hidden="true">22.1.</strong> Non-Deterministic Read-only Memory</a></li><li class="chapter-item expanded "><a href="ch202-02-segments.html"><strong aria-hidden="true">22.2.</strong> Segments and Relocation</a></li></ol></li><li class="chapter-item expanded "><a href="ch203-00-execution-model.html"><strong aria-hidden="true">23.</strong> Execution Model</a></li><li class="chapter-item expanded "><a href="ch204-00-builtins.html"><strong aria-hidden="true">24.</strong> Builtins</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch204-01-how-builtins-work.html"><strong aria-hidden="true">24.1.</strong> How Builtins Work</a></li><li class="chapter-item expanded "><a href="ch204-02-builtins-list.html"><strong aria-hidden="true">24.2.</strong> Builtins List</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch204-02-00-output.html"><strong aria-hidden="true">24.2.1.</strong> Output</a></li><li class="chapter-item "><a href="ch204-02-01-pedersen.html"><strong aria-hidden="true">24.2.2.</strong> Pedersen</a></li><li class="chapter-item "><a href="ch204-02-02-range-check.html"><strong aria-hidden="true">24.2.3.</strong> Range Check</a></li><li class="chapter-item "><a href="ch204-02-03-ecdsa.html"><strong aria-hidden="true">24.2.4.</strong> ECDSA</a></li><li class="chapter-item "><a href="ch204-02-04-bitwise.html"><strong aria-hidden="true">24.2.5.</strong> Bitwise</a></li><li class="chapter-item "><a href="ch204-02-05-ec-op.html"><strong aria-hidden="true">24.2.6.</strong> EC OP</a></li><li class="chapter-item "><a href="ch204-02-06-keccak.html"><strong aria-hidden="true">24.2.7.</strong> Keccak</a></li><li class="chapter-item "><a href="ch204-02-07-poseidon.html"><strong aria-hidden="true">24.2.8.</strong> Poseidon</a></li><li class="chapter-item "><a href="ch204-02-08-mod-builtin.html"><strong aria-hidden="true">24.2.9.</strong> Mod Builtin</a></li><li class="chapter-item "><a href="ch204-02-11-segment-arena.html"><strong aria-hidden="true">24.2.10.</strong> Segment Arena</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="ch205-00-hints.html"><strong aria-hidden="true">25.</strong> Hints</a></li><li class="chapter-item expanded "><a href="ch206-00-runner.html"><strong aria-hidden="true">26.</strong> Runner</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">26.1.</strong> Program</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">26.1.1.</strong> Program Artifacts</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.1.2.</strong> Program Parsing</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">26.2.</strong> Runner Mode</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">26.2.1.</strong> Execution Mode</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.2.2.</strong> Proof Mode</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">26.3.</strong> Output</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">26.3.1.</strong> Cairo PIE</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.3.2.</strong> Memory File</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.3.3.</strong> Trace file</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.3.4.</strong> AIR public input</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.3.5.</strong> AIR private input</div></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">27.</strong> Tracer</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">28.</strong> Implementations</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">29.</strong> Resources</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                            aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                            aria-label="Change theme" aria-haspopup="true" aria-expanded="false"
                            aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Cairo Programming Language</h1>


                    <div class="right-buttons">
                        <div class="menu-cairo-home-wrapper">
                            <a href="https://cairo-lang.org" class="menu-cairo-home" title="Cairo Home"
                                aria-label="Cairo Home">
                                <img src="/icons/Cairo_logo_500x500.png" alt="Cairo Logo"
                                    class="cairo-logo">
                                <span class="menu-cairo-home-text">Cairo Home</span>
                            </a>
                        </div>
                        <div class="menu-cairo-home-wrapper">
                            <a href="https://starknet.io" class="menu-cairo-home" title="Starknet" aria-label="Starknet">
                                <img src="/icons/SN_logo.png" alt="Starknet Logo"
                                    class="cairo-logo">
                                <span class="menu-cairo-home-text">Starknet</span>
                            </a>
                        </div>
                        <button id="language-toggle" class="icon-button" type="button" title="Change language"
                            aria-label="Change language" aria-haspopup="true" aria-expanded="false"
                            aria-controls="language-list">
                            <i class="fa fa-globe"></i>
                        </button>
                        <ul id="language-list" class="theme-popup" aria-label="Languages" role="menu">
                            <li role="none"><button role="menuitem" class="theme">
                                    <a id="en">English</a>
                                </button></li>
                        </ul>
                        <script>
                            let langToggle = document.getElementById("language-toggle");
                            let langList = document.getElementById("language-list");
                            langToggle.addEventListener("click", (event) => {
                                langList.style.display = langList.style.display == "block" ? "none" : "block";
                            });
                            let selectedLang = document.getElementById("id");
                            selectedLang.parentNode.classList.add("theme-selected");

                            // The path to the root, taking the current
                            // language into account.
                            { { #if(eq language "en") } }
                            let full_path_to_root = "";
                            { {else } }
                            let full_path_to_root = "../";
                            { {/if } }
                            // The page path (mdbook only gives us
                            // access to the path to the Markdown file).
                            let path = "ch12-06-inlining-in-cairo.md".replace(/\.md$/, ".html");
                            for (let lang of langList.querySelectorAll("a")) {
                                if (lang.id == "en") {
                                    lang.href = `${full_path_to_root}${path}`;
                                } else {
                                    lang.href = `${full_path_to_root}${lang.id}/${path}`;
                                }
                            }
                        </script>

                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cairo-book/cairo-book.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/cairo-book/cairo-book.github.io/edit/main/src/ch12-06-inlining-in-cairo.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                            aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="inlining-in-cairo"><a class="header" href="#inlining-in-cairo">Inlining in Cairo</a></h1>
<p>Inlining is a common code optimization technique supported by most compilers. It
involves replacing a function call at the call site with the actual code of the
called function, eliminating the overhead associated with the function call
itself. This can improve performance by reducing the number of instructions
executed, but may increase the total size of the program. When you're thinking
about whether to inline a function, take into account things like how big it is,
what parameters it has, how often it gets called, and how it might affect the
size of your compiled code.</p>
<h2 id="the-inline-attribute"><a class="header" href="#the-inline-attribute">The <code>inline</code> Attribute</a></h2>
<p>In Cairo, the <code>inline</code> attribute suggests whether or not the Sierra code
corresponding to the attributed function should be directly injected in the
caller function's context, rather than using a <code>function_call</code> libfunc to
execute that code.</p>
<p>There are three variants of the <code>inline</code> attribute that one can use:</p>
<ul>
<li><code>#[inline]</code> suggests performing an inline expansion.</li>
<li><code>#[inline(always)]</code> suggests that an inline expansion should always be
performed.</li>
<li><code>#[inline(never)]</code> suggests that an inline expansion should never be
performed.</li>
</ul>
<blockquote>
<p>Note: the <code>inline</code> attribute in every form is a hint, with no requirements on
the language to place a copy of the attributed function in the caller. This
means that the attribute may be ignored by the compiler. In practice,
<code>#[inline(always)]</code> will cause inlining in all but the most exceptional cases.</p>
</blockquote>
<p>Many of the Cairo corelib functions are inlined. User-defined functions may also
be annotated with the <code>inline</code> attribute. Annotating functions with the
<code>#[inline(always)]</code> attribute reduces the total number of steps required when
calling these attributed functions. Indeed, injecting the Sierra code at the
caller site avoids the step-cost involved in calling functions and obtaining
their arguments.</p>
<p>However, inlining can also lead to increased code size. Whenever a function is
inlined, the call site contains a copy of the function's Sierra code,
potentially leading to duplication of code across the compiled code.</p>
<p>Therefore, inlining should be applied with caution. Using <code>#[inline]</code> or
<code>#[inline(always)]</code> indiscriminately will lead to increased compile time. It is
particularly useful to inline small functions, ideally with many arguments. This
is because inlining large functions will increase the code length of the
program, and handling many arguments will increase the number of steps to
execute these functions.</p>
<p>The more frequently a function is called, the more beneficial inlining becomes
in terms of performance. By doing so, the number of steps for the execution will
be lower, while the code length will not grow that much or might even decrease
in terms of total number of instructions.</p>
<blockquote>
<p>Inlining is often a tradeoff between number of steps and code length. Use the
<code>inline</code> attribute cautiously where it is appropriate.</p>
</blockquote>
<h2 id="inlining-decision-process"><a class="header" href="#inlining-decision-process">Inlining decision process</a></h2>
<p>The Cairo compiler follows the <code>inline</code> attribute but for functions without
explicit inline directives, it will use a heuristic approach. The decision to
inline or not a function will be made depending on the complexity of the
attributed function and mostly rely on the threshold
<code>DEFAULT_INLINE_SMALL_FUNCTIONS_THRESHOLD</code>.</p>
<p>The compiler calculates a function's "weight" using the <code>ApproxCasmInlineWeight</code>
struct, which estimates the number of Cairo Assembly (CASM) statements the
function will generate. This weight calculation provides a more nuanced view of
the function's complexity than a simple statement count. If a function's weight
falls below the threshold, it will be inlined.</p>
<p>In addition to the weight-based approach, the compiler also considers the raw
statement count. Functions with fewer statements than the threshold are
typically inlined, promoting the optimization of small, frequently called
functions.</p>
<p>The inlining process also accounts for special cases. Very simple functions,
such as those that only call another function or return a constant, are always
inlined regardless of other factors. Conversely, functions with complex control
flow structures like <code>Match</code> or those ending with a <code>Panic</code> are generally not
inlined.</p>
<h2 id="inlining-example"><a class="header" href="#inlining-example">Inlining Example</a></h2>
<p>Let's introduce a short example to illustrate the mechanisms of inlining in
Cairo. Listing 12-5 shows a basic program allowing comparison
between inlined and non-inlined functions.</p>
<pre><code class="language-cairo">#[executable]
fn main() -&gt; felt252 {
    inlined() + not_inlined()
}

#[inline(always)]
fn inlined() -&gt; felt252 {
    1
}

#[inline(never)]
fn not_inlined() -&gt; felt252 {
    2
}
</code></pre>
<p>Cairo program that adds the return value of 2 functions, with one of them being
inlined</span></p>
<p>Let's take a look at the corresponding Sierra code to see how inlining works
under the hood:</p>
<pre><code class="language-cairo noplayground">// type declarations
type felt252 = felt252 [storable: true, drop: true, dup: true, zero_sized: false]

// libfunc declarations
libfunc function_call&lt;user@main::main::not_inlined&gt; = function_call&lt;user@main::main::not_inlined&gt;
libfunc felt252_const&lt;1&gt; = felt252_const&lt;1&gt;
libfunc store_temp&lt;felt252&gt; = store_temp&lt;felt252&gt;
libfunc felt252_add = felt252_add
libfunc felt252_const&lt;2&gt; = felt252_const&lt;2&gt;

// statements
00 function_call&lt;user@main::main::not_inlined&gt;() -&gt; ([0])
01 felt252_const&lt;1&gt;() -&gt; ([1])
02 store_temp&lt;felt252&gt;([1]) -&gt; ([1])
03 felt252_add([1], [0]) -&gt; ([2])
04 store_temp&lt;felt252&gt;([2]) -&gt; ([2])
05 return([2])
06 felt252_const&lt;1&gt;() -&gt; ([0])
07 store_temp&lt;felt252&gt;([0]) -&gt; ([0])
08 return([0])
09 felt252_const&lt;2&gt;() -&gt; ([0])
10 store_temp&lt;felt252&gt;([0]) -&gt; ([0])
11 return([0])

// funcs
main::main::main@0() -&gt; (felt252)
main::main::inlined@6() -&gt; (felt252)
main::main::not_inlined@9() -&gt; (felt252)
</code></pre>
<p>The Sierra file is structured in three parts:</p>
<ul>
<li>Type and libfunc declarations.</li>
<li>Statements that constitute the program.</li>
<li>Declaration of the functions of the program.</li>
</ul>
<p>The Sierra code statements always match the order of function declarations in
the Cairo program. Indeed, the declaration of the functions of the program tells
us that:</p>
<ul>
<li><code>main</code> function starts at line 0, and returns a <code>felt252</code> on line 5.</li>
<li><code>inlined</code> function starts at line 6, and returns a <code>felt252</code> on line 8.</li>
<li><code>not_inlined</code> function starts at line 9, and returns a <code>felt252</code> on line 11.</li>
</ul>
<p>All statements corresponding to the <code>main</code> function are located between lines 0
and 5:</p>
<pre><code class="language-cairo noplayground">00 function_call&lt;user@main::main::not_inlined&gt;() -&gt; ([0])
01 felt252_const&lt;1&gt;() -&gt; ([1])
02 store_temp&lt;felt252&gt;([1]) -&gt; ([1])
03 felt252_add([1], [0]) -&gt; ([2])
04 store_temp&lt;felt252&gt;([2]) -&gt; ([2])
05 return([2])
</code></pre>
<p>The <code>function_call</code> libfunc is called on line 0 to execute the <code>not_inlined</code>
function. This will execute the code from lines 9 to 10 and store the return
value in the variable with id <code>0</code>.</p>
<pre><code class="language-cairo noplayground">09	felt252_const&lt;2&gt;() -&gt; ([0])
10	store_temp&lt;felt252&gt;([0]) -&gt; ([0])
</code></pre>
<p>This code uses a single data type, <code>felt252</code>. It uses two library functions
- <code>felt252_const&lt;2&gt;</code>, which returns the constant <code>felt252</code> 2,
and <code>store_temp&lt;felt252&gt;</code>, which pushes a constant value to memory. The first
line calls the <code>felt252_const&lt;2&gt;</code> libfunc to create a variable with id <code>0</code>.
Then, the second line pushes this variable to memory for later use.</p>
<p>After that, Sierra statements from line 1 to 2 are the actual body of the
<code>inlined</code> function:</p>
<pre><code class="language-cairo noplayground">06	felt252_const&lt;1&gt;() -&gt; ([0])
07	store_temp&lt;felt252&gt;([0]) -&gt; ([0])
</code></pre>
<p>The only difference is that the inlined code will store the <code>felt252_const</code>
value in a variable with id <code>1</code>, because <code>[0]</code> refers to a variable previously
assigned:</p>
<pre><code class="language-cairo noplayground">01	felt252_const&lt;1&gt;() -&gt; ([1])
02	store_temp&lt;felt252&gt;([1]) -&gt; ([1])
</code></pre>
<blockquote>
<p>Note: in both cases (inlined or not), the <code>return</code> instruction of the function
being called is not executed, as this would lead to prematurely end the
execution of the <code>main</code> function. Instead, return values of <code>inlined</code> and
<code>not_inlined</code> will be added and the result will be returned.</p>
</blockquote>
<p>Lines 3 to 5 contain the Sierra statements that will add the values contained in
variables with ids <code>0</code> and <code>1</code>, store the result in memory and return it:</p>
<pre><code class="language-cairo noplayground">03	felt252_add([1], [0]) -&gt; ([2])
04	store_temp&lt;felt252&gt;([2]) -&gt; ([2])
05	return([2])
</code></pre>
<p>Now, let's take a look at the Casm code corresponding to this program to really
understand the benefits of inlining.</p>
<h2 id="casm-code-explanations"><a class="header" href="#casm-code-explanations">Casm Code Explanations</a></h2>
<p>Here is the Casm code for our previous program example:</p>
<pre><code class="language-cairo noplayground">1	call rel 3
2	ret
3	call rel 9
4	[ap + 0] = 1, ap++
5	[ap + 0] = [ap + -1] + [ap + -2], ap++
6	ret
7	[ap + 0] = 1, ap++
8	ret
9	[ap + 0] = 2, ap++
10	ret
11	ret
</code></pre>
<p>Don't hesitate to use <a href="https://cairovm.codes/">cairovm.codes</a> playground to
follow along and see all the execution trace.</p>
<p>Each instruction and each argument for any instruction increment the Program
Counter (known as PC) by 1. This means that <code>ret</code> on line 2 is actually the
instruction at <code>PC = 3</code>, as the argument <code>3</code> corresponds to <code>PC = 2</code>.</p>
<p>The <code>call</code> and <code>ret</code> instructions allow implementation of a function stack:</p>
<ul>
<li><code>call</code> instruction acts like a jump instruction, updating the PC to a given
value, whether relatively to the current value using <code>rel</code> or absolutely using
<code>abs</code>.</li>
<li><code>ret</code> instruction jumps back right after the <code>call</code> instruction and continues
the execution of the code.</li>
</ul>
<p>We can now decompose how these instructions are executed to understand what this
code does:</p>
<ul>
<li><code>call rel 3</code>: this instruction increments the PC by 3 and executes the
instruction at this location, which is <code>call rel 9</code> at <code>PC = 4</code>.</li>
<li><code>call rel 9</code> increments the PC by 9 and executes the instruction at <code>PC = 13</code>,
which is actually line 9.</li>
<li><code>[ap + 0] = 2, ap++</code>: <code>ap</code> stands for Allocation Pointer, which points to the
first memory cell that has not been used by the program so far. This means we
store the value <code>2</code> in the next free memory cell indicated by the current
value of <code>ap</code>, after which we increment <code>ap</code> by 1. Then, we go to the next
line which is <code>ret</code>.</li>
<li><code>ret</code>: jumps back to the line after <code>call rel 9</code>, so we go to line 4.</li>
<li><code>[ap + 0] = 1, ap++</code> : we store the value <code>1</code> in <code>[ap]</code> and we apply <code>ap++</code> so
that <code>[ap - 1] = 1</code>. This means we now have <code>[ap-1] = 1, [ap-2] = 2</code> and we go
to the next line.</li>
<li><code>[ap + 0] = [ap + -1] + [ap + -2], ap++</code>: we sum the values <code>1</code> and <code>2</code> and
store the result in <code>[ap]</code>, and we apply <code>ap++</code> so the result is
<code>[ap-1] = 3, [ap-2] = 1, [ap-3]=2</code>.</li>
<li><code>ret</code>: jumps back to the line after <code>call rel 3</code>, so we go to line 2.</li>
<li><code>ret</code>: last instruction executed as there is no more <code>call</code> instruction where
to jump right after. This is the actual return instruction of the Cairo <code>main</code>
function.</li>
</ul>
<p>To summarize:</p>
<ul>
<li><code>call rel 3</code> corresponds to the <code>main</code> function, which is obviously not
inlined.</li>
<li><code>call rel 9</code> triggers the call to the <code>not_inlined</code> function, which returns
<code>2</code> and stores it at the final location <code>[ap-3]</code>.</li>
<li>The line 4 is the inlined code of the <code>inlined</code> function, which returns <code>1</code>
and stores it at the final location <code>[ap-2]</code>. We clearly see that there is no
<code>call</code> instruction in this case, because the body of the function is inserted
and directly executed.</li>
<li>After that, the sum is computed and we ultimately go back to the line 2 which
contains the final <code>ret</code> instruction that returns the sum, corresponding to
the return value of the <code>main</code> function.</li>
</ul>
<p>It is interesting to note that in both Sierra code and Casm code, the
<code>not_inlined</code> function will be called and executed before the body of the
<code>inlined</code> function, even though the Cairo program executes
<code>inlined() + not_inlined()</code>.</p>
<blockquote>
<p>The Casm code of our program clearly shows that there is a function call for
the <code>not_inlined</code> function, while the <code>inlined</code> function is correctly inlined.</p>
</blockquote>
<h2 id="additional-optimizations"><a class="header" href="#additional-optimizations">Additional Optimizations</a></h2>
<p>Let's study another program that shows other benefits that inlining may
sometimes provide. Listing 12-6 shows a Cairo program that
calls 2 functions and doesn't return anything:</p>
<pre><code class="language-cairo">#[executable]
fn main() {
    inlined();
    not_inlined();
}

#[inline(always)]
fn inlined() -&gt; felt252 {
    'inlined'
}

#[inline(never)]
fn not_inlined() -&gt; felt252 {
    'not inlined'
}
</code></pre>
<p>small Cairo program that calls <code>inlined</code> and <code>not_inlined</code> and doesn't return
any value.</span></p>
<p>Here is the corresponding Sierra code:</p>
<pre><code class="language-cairo noplayground">// type declarations
type felt252 = felt252 [storable: true, drop: true, dup: true, zero_sized: false]
type Unit = Struct&lt;ut@Tuple&gt; [storable: true, drop: true, dup: true, zero_sized: true]

// libfunc declarations
libfunc function_call&lt;user@main::main::not_inlined&gt; = function_call&lt;user@main::main::not_inlined&gt;
libfunc drop&lt;felt252&gt; = drop&lt;felt252&gt;
libfunc struct_construct&lt;Unit&gt; = struct_construct&lt;Unit&gt;
libfunc felt252_const&lt;29676284458984804&gt; = felt252_const&lt;29676284458984804&gt;
libfunc store_temp&lt;felt252&gt; = store_temp&lt;felt252&gt;
libfunc felt252_const&lt;133508164995039583817065828&gt; = felt252_const&lt;133508164995039583817065828&gt;

// statements
00 function_call&lt;user@main::main::not_inlined&gt;() -&gt; ([0])
01 drop&lt;felt252&gt;([0]) -&gt; ()
02 struct_construct&lt;Unit&gt;() -&gt; ([1])
03 return([1])
04 felt252_const&lt;29676284458984804&gt;() -&gt; ([0])
05 store_temp&lt;felt252&gt;([0]) -&gt; ([0])
06 return([0])
07 felt252_const&lt;133508164995039583817065828&gt;() -&gt; ([0])
08 store_temp&lt;felt252&gt;([0]) -&gt; ([0])
09 return([0])

// funcs
main::main::main@0() -&gt; (Unit)
main::main::inlined@4() -&gt; (felt252)
main::main::not_inlined@7() -&gt; (felt252)
</code></pre>
<p>In this specific case, we can observe that the compiler has applied additional
optimizations to the <code>main</code> function of our code : the code of the <code>inlined</code>
function, which is annotated with the <code>#[inline(always)]</code> attribute, is actually
not copied in the <code>main</code> function. Instead, the <code>main</code> function starts with the
<code>function_call</code> libfunc to call the <code>not_inlined</code> function, entirely omitting
the code of the <code>inlined</code> function.</p>
<blockquote>
<p>Because <code>inlined</code> return value is never used, the compiler optimizes the
<code>main</code> function by skipping the <code>inlined</code> function code. This will actually
reduce the code length while reducing the number of steps required to execute
<code>main</code>.</p>
</blockquote>
<p>In contrast, line 0 uses the <code>function_call</code> libfunc to execute the
<code>not_inlined</code> function normally. This means that all the code from lines 7 to 8
will be executed:</p>
<pre><code class="language-cairo noplayground">07 felt252_const&lt;133508164995039583817065828&gt;() -&gt; ([0])
08 store_temp&lt;felt252&gt;([0]) -&gt; ([0])
</code></pre>
<p>This value stored in the variable with id <code>0</code> is then dropped on line 1, as it
is not used in the <code>main</code> function:</p>
<pre><code class="language-cairo noplayground">01 drop&lt;felt252&gt;([0]) -&gt; ()
</code></pre>
<p>Finally, as the <code>main</code> function doesn't return any value, a variable of unit
type <code>()</code> is created and returned:</p>
<pre><code class="language-cairo noplayground">02 struct_construct&lt;Unit&gt;() -&gt; ([1])
03 return([1])
</code></pre>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Inlining is a compiler optimization technique that can be very useful in various
situations. Inlining a function allows to get rid of the overhead of calling a
function with the <code>function_call</code> libfunc by injecting the Sierra code directly
in the caller function's context, while potentially optimizing the Sierra code
executed to reduce the number of steps. If used effectively, inlining can even
reduce code length as shown in the previous example.</p>
<p>Nevertheless, applying the <code>inline</code> attribute to a function with a lot of code
and few parameters might result in an increased code size, especially if the
inlined function is used many times in the codebase. Use inlining only where it
makes sense, and be aware that the compiler handles inlining by default.
Therefore, manually applying inlining is not recommended in most situations, but
can help improve and fine-tune your code's behavior.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <a rel="prev" href="ch12-10-procedural-macros.html" class="mobile-nav-chapters previous"
                            title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                            <i class="fa fa-angle-left"></i>
                        </a>

                        <a rel="next" href="ch12-08-printing.html" class="mobile-nav-chapters next"
                            title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                            <i class="fa fa-angle-right"></i>
                        </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                <a rel="prev" href="ch12-10-procedural-macros.html" class="nav-chapters previous" title="Previous chapter"
                    aria-label="Previous chapter" aria-keyshortcuts="Left">
                    <i class="fa fa-angle-left"></i>
                </a>

                <a rel="next" href="ch12-08-printing.html" class="nav-chapters next" title="Next chapter"
                    aria-label="Next chapter" aria-keyshortcuts="Right">
                    <i class="fa fa-angle-right"></i>
                </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>

        <!-- Cairo WASM compiler for in-browser code execution (runs in Web Worker) -->
        <script>
            (function () {
                var rootPath = "";
                var workerUrl = "./" + rootPath + "wasm/cairo_worker.js";
                var worker = new Worker(workerUrl, { type: "module" });
                var nextId = 0;
                var pending = {};

                worker.onmessage = function (e) {
                    if (e.data.type === "ready") {
                        window.cairoWasmReady = true;
                        console.log("Cairo WASM worker initialized");
                        return;
                    }
                    if (e.data.type === "result") {
                        var cb = pending[e.data.id];
                        if (cb) {
                            delete pending[e.data.id];
                            if (e.data.error) {
                                cb.reject(new Error(e.data.error));
                            } else {
                                cb.resolve(e.data.response);
                            }
                        }
                    }
                };

                window.cairoWasm = {
                    compile_and_run: function (requestJson) {
                        var id = nextId++;
                        return new Promise(function (resolve, reject) {
                            pending[id] = { resolve: resolve, reject: reject };
                            worker.postMessage({ type: "run", id: id, request: JSON.parse(requestJson) });
                        });
                    }
                };
            })();
        </script>

        <script src="book.js"></script>
        <script>
            window.rootPath = "";
        </script>

        <!-- Custom JS scripts -->
        <script src="theme/chat.js"></script>
        <script src="theme/js/version-switcher.js"></script>


    </div>
</body>

</html>
