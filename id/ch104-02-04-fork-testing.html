<!DOCTYPE HTML>
<html lang="id" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Fork Testing - The Cairo Programming Language</title>


    <!-- Custom HTML head -->

    <meta name="description" content="The Cairo Programming Language. A comprehensive documentation for Cairo, the smart contract language for Starknet.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
    <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="theme/css/last-changed.css">
    <link rel="stylesheet" href="theme/css/chat.css">
    <link rel="stylesheet" href="theme/css/version-switcher.css">

    <!-- MathJax -->
    <script async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <link rel="canonical" id="canonical-link" href="" />
    <script>
        (function () {
            var path = "ch104-02-04-fork-testing.md";
            var canonicalPath;

            // Special handling for different cases
            if (path === "" || path === "index.md") {
                // Homepage should not have index.html
                canonicalPath = "";
            } else {
                // Other pages: replace .md with .html
                canonicalPath = path.replace(/\.md$/, ".html");
            }

            var canonicalUrl = "https://www.starknet.io/cairo-book/" + canonicalPath;

            // Remove trailing slash if present (except for root)
            if (canonicalUrl.endsWith("/") && canonicalUrl !== "https://www.starknet.io/cairo-book/") {
                canonicalUrl = canonicalUrl.slice(0, -1);
            }

            document.getElementById("canonical-link").href = canonicalUrl;
        })();
    </script>

    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-M6M97KJP');</script>
    <!-- End Google Tag Manager -->
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M6M97KJP" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-0ZJLBV4KE2"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());

            gtag('config', 'G-0ZJLBV4KE2'); // lfg
            gtag('config', 'G-WY42TERK5P') // starknet
            gtag('config', 'G-1CHRL0BVJC'); // pers
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title-page.html">The Cairo Book</a></li><li class="chapter-item expanded affix "><a href="ch00-01-foreword.html">Foreword</a></li><li class="chapter-item expanded affix "><a href="ch00-00-introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">The Cairo Programming Language</li><li class="chapter-item expanded "><a href="ch01-00-getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch01-01-installation.html"><strong aria-hidden="true">1.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="ch01-02-hello-world.html"><strong aria-hidden="true">1.2.</strong> Hello, World!</a></li><li class="chapter-item expanded "><a href="ch01-03-proving-a-prime-number.html"><strong aria-hidden="true">1.3.</strong> Proving That A Number Is Prime</a></li></ol></li><li class="chapter-item expanded "><a href="ch02-00-common-programming-concepts.html"><strong aria-hidden="true">2.</strong> Common Programming Concepts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch02-01-variables-and-mutability.html"><strong aria-hidden="true">2.1.</strong> Variables and Mutability</a></li><li class="chapter-item expanded "><a href="ch02-02-data-types.html"><strong aria-hidden="true">2.2.</strong> Data Types</a></li><li class="chapter-item expanded "><a href="ch02-03-functions.html"><strong aria-hidden="true">2.3.</strong> Functions</a></li><li class="chapter-item expanded "><a href="ch02-04-comments.html"><strong aria-hidden="true">2.4.</strong> Comments</a></li><li class="chapter-item expanded "><a href="ch02-05-control-flow.html"><strong aria-hidden="true">2.5.</strong> Control Flow</a></li></ol></li><li class="chapter-item expanded "><a href="ch03-00-common-collections.html"><strong aria-hidden="true">3.</strong> Common Collections</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch03-01-arrays.html"><strong aria-hidden="true">3.1.</strong> Arrays</a></li><li class="chapter-item expanded "><a href="ch03-02-dictionaries.html"><strong aria-hidden="true">3.2.</strong> Dictionaries</a></li></ol></li><li class="chapter-item expanded "><a href="ch04-00-understanding-ownership.html"><strong aria-hidden="true">4.</strong> Understanding Ownership</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch04-01-what-is-ownership.html"><strong aria-hidden="true">4.1.</strong> What is Ownership?</a></li><li class="chapter-item expanded "><a href="ch04-02-references-and-snapshots.html"><strong aria-hidden="true">4.2.</strong> References and Snapshots</a></li></ol></li><li class="chapter-item expanded "><a href="ch05-00-using-structs-to-structure-related-data.html"><strong aria-hidden="true">5.</strong> Using Structs to Structure Related Data</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch05-01-defining-and-instantiating-structs.html"><strong aria-hidden="true">5.1.</strong> Defining and Instantiating Structs</a></li><li class="chapter-item expanded "><a href="ch05-02-an-example-program-using-structs.html"><strong aria-hidden="true">5.2.</strong> An Example Program Using Structs</a></li><li class="chapter-item expanded "><a href="ch05-03-method-syntax.html"><strong aria-hidden="true">5.3.</strong> Method Syntax</a></li></ol></li><li class="chapter-item expanded "><a href="ch06-00-enums-and-pattern-matching.html"><strong aria-hidden="true">6.</strong> Enums and Pattern Matching</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch06-01-enums.html"><strong aria-hidden="true">6.1.</strong> Enums</a></li><li class="chapter-item expanded "><a href="ch06-02-the-match-control-flow-construct.html"><strong aria-hidden="true">6.2.</strong> The Match Control Flow Construct</a></li><li class="chapter-item expanded "><a href="ch06-03-concise-control-flow-with-if-let-and-while-let.html"><strong aria-hidden="true">6.3.</strong> Concise Control Flow with if let and while let</a></li></ol></li><li class="chapter-item expanded "><a href="ch07-00-managing-cairo-projects-with-packages-crates-and-modules.html"><strong aria-hidden="true">7.</strong> Managing Cairo Projects with Packages, Crates and Modules</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch07-01-packages-and-crates.html"><strong aria-hidden="true">7.1.</strong> Packages and Crates</a></li><li class="chapter-item expanded "><a href="ch07-02-defining-modules-to-control-scope.html"><strong aria-hidden="true">7.2.</strong> Defining Modules to Control Scope</a></li><li class="chapter-item expanded "><a href="ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html"><strong aria-hidden="true">7.3.</strong> Paths for Referring to an Item in the Module Tree</a></li><li class="chapter-item expanded "><a href="ch07-04-bringing-paths-into-scope-with-the-use-keyword.html"><strong aria-hidden="true">7.4.</strong> Bringing Paths into Scope with the use Keyword</a></li><li class="chapter-item expanded "><a href="ch07-05-separating-modules-into-different-files.html"><strong aria-hidden="true">7.5.</strong> Separating Modules into Different Files</a></li></ol></li><li class="chapter-item expanded "><a href="ch08-00-generic-types-and-traits.html"><strong aria-hidden="true">8.</strong> Generic Types and Traits</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch08-01-generic-data-types.html"><strong aria-hidden="true">8.1.</strong> Generic Data Types</a></li><li class="chapter-item expanded "><a href="ch08-02-traits-in-cairo.html"><strong aria-hidden="true">8.2.</strong> Traits in Cairo</a></li></ol></li><li class="chapter-item expanded "><a href="ch09-00-error-handling.html"><strong aria-hidden="true">9.</strong> Error Handling</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch09-01-unrecoverable-errors-with-panic.html"><strong aria-hidden="true">9.1.</strong> Unrecoverable Errors with panic</a></li><li class="chapter-item expanded "><a href="ch09-02-recoverable-errors.html"><strong aria-hidden="true">9.2.</strong> Recoverable Errors with Result</a></li></ol></li><li class="chapter-item expanded "><a href="ch10-00-testing-cairo-programs.html"><strong aria-hidden="true">10.</strong> Testing Cairo Programs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch10-01-how-to-write-tests.html"><strong aria-hidden="true">10.1.</strong> How To Write Tests</a></li><li class="chapter-item expanded "><a href="ch10-02-test-organization.html"><strong aria-hidden="true">10.2.</strong> Test Organization</a></li></ol></li><li class="chapter-item expanded "><a href="ch11-00-functional-features.html"><strong aria-hidden="true">11.</strong> Functional Language Features: Iterators and Closures</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch11-01-closures.html"><strong aria-hidden="true">11.1.</strong> Closures: Anonymous Functions that Capture Their Environment</a></li></ol></li><li class="chapter-item expanded "><a href="ch12-00-advanced-features.html"><strong aria-hidden="true">12.</strong> Advanced Cairo Features</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch12-01-custom-data-structures.html"><strong aria-hidden="true">12.1.</strong> Custom Data Structures</a></li><li class="chapter-item expanded "><a href="ch12-02-smart-pointers.html"><strong aria-hidden="true">12.2.</strong> Smart Pointers</a></li><li class="chapter-item expanded "><a href="ch12-09-deref-coercion.html"><strong aria-hidden="true">12.3.</strong> Deref Coercion</a></li><li class="chapter-item expanded "><a href="ch12-10-associated-items.html"><strong aria-hidden="true">12.4.</strong> Associated Items</a></li><li class="chapter-item expanded "><a href="ch12-03-operator-overloading.html"><strong aria-hidden="true">12.5.</strong> Operator Overloading</a></li><li class="chapter-item expanded "><a href="ch12-04-hash.html"><strong aria-hidden="true">12.6.</strong> Working with Hashes</a></li><li class="chapter-item expanded "><a href="ch12-05-macros.html"><strong aria-hidden="true">12.7.</strong> Macros</a></li><li class="chapter-item expanded "><a href="ch12-10-procedural-macros.html"><strong aria-hidden="true">12.8.</strong> Procedural Macros</a></li><li class="chapter-item expanded "><a href="ch12-06-inlining-in-cairo.html"><strong aria-hidden="true">12.9.</strong> Inlining in Cairo</a></li><li class="chapter-item expanded "><a href="ch12-08-printing.html"><strong aria-hidden="true">12.10.</strong> Printing</a></li><li class="chapter-item expanded "><a href="ch12-10-arithmetic-circuits.html"><strong aria-hidden="true">12.11.</strong> Arithmetic Circuits</a></li><li class="chapter-item expanded "><a href="ch12-11-offloading-computations-with-oracles.html"><strong aria-hidden="true">12.12.</strong> Offloading Computations with Oracles</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-00.html"><strong aria-hidden="true">13.</strong> Appendix (Cairo)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-01-keywords.html"><strong aria-hidden="true">13.1.</strong> A - Keywords</a></li><li class="chapter-item expanded "><a href="appendix-02-operators-and-symbols.html"><strong aria-hidden="true">13.2.</strong> B - Operators and Symbols</a></li><li class="chapter-item expanded "><a href="appendix-03-derivable-traits.html"><strong aria-hidden="true">13.3.</strong> C - Derivable Traits</a></li><li class="chapter-item expanded "><a href="appendix-04-cairo-prelude.html"><strong aria-hidden="true">13.4.</strong> D - The Cairo Prelude</a></li><li class="chapter-item expanded "><a href="appendix-05-common-error-messages.html"><strong aria-hidden="true">13.5.</strong> E - Common Error Messages</a></li><li class="chapter-item expanded "><a href="appendix-06-useful-development-tools.html"><strong aria-hidden="true">13.6.</strong> F - Useful Development Tools</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Smart Contracts in Cairo</li><li class="chapter-item expanded "><a href="ch100-00-introduction-to-smart-contracts.html"><strong aria-hidden="true">14.</strong> Introduction to Smart Contracts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch100-01-contracts-classes-and-instances.html"><strong aria-hidden="true">14.1.</strong> Starknet contract classes and instances</a></li></ol></li><li class="chapter-item expanded "><a href="ch101-00-building-starknet-smart-contracts.html"><strong aria-hidden="true">15.</strong> Building Starknet Smart Contracts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch101-01-starknet-types.html"><strong aria-hidden="true">15.1.</strong> Starknet Types</a></li><li class="chapter-item expanded "><a href="ch101-01-00-contract-storage.html"><strong aria-hidden="true">15.2.</strong> Contract Storage</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch101-01-01-storage-mappings.html"><strong aria-hidden="true">15.2.1.</strong> Storage Mappings</a></li><li class="chapter-item "><a href="ch101-01-02-storage-vecs.html"><strong aria-hidden="true">15.2.2.</strong> Storage Vecs</a></li></ol></li><li class="chapter-item expanded "><a href="ch101-02-contract-functions.html"><strong aria-hidden="true">15.3.</strong> Contract Functions</a></li><li class="chapter-item expanded "><a href="ch101-03-contract-events.html"><strong aria-hidden="true">15.4.</strong> Contract Events</a></li></ol></li><li class="chapter-item expanded "><a href="ch102-00-starknet-contract-interactions.html"><strong aria-hidden="true">16.</strong> Starknet Contract Interactions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch102-01-contract-class-abi.html"><strong aria-hidden="true">16.1.</strong> Contract Class ABI</a></li><li class="chapter-item expanded "><a href="ch102-02-interacting-with-another-contract.html"><strong aria-hidden="true">16.2.</strong> Interacting with Another Contract</a></li><li class="chapter-item expanded "><a href="ch102-03-executing-code-from-another-class.html"><strong aria-hidden="true">16.3.</strong> Executing Code from Another Class</a></li><li class="chapter-item expanded "><a href="ch102-04-serialization-of-cairo-types.html"><strong aria-hidden="true">16.4.</strong> Serialization of Cairo types</a></li></ol></li><li class="chapter-item expanded "><a href="ch103-00-building-advanced-starknet-smart-contracts.html"><strong aria-hidden="true">17.</strong> Building Advanced Starknet Smart Contracts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch103-01-optimizing-storage-costs.html"><strong aria-hidden="true">17.1.</strong> Optimizing Storage Costs</a></li><li class="chapter-item expanded "><a href="ch103-02-00-composability-and-components.html"><strong aria-hidden="true">17.2.</strong> Composability and Components</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch103-02-01-under-the-hood.html"><strong aria-hidden="true">17.2.1.</strong> Under the Hood</a></li><li class="chapter-item "><a href="ch103-02-02-component-dependencies.html"><strong aria-hidden="true">17.2.2.</strong> Component Dependencies</a></li><li class="chapter-item "><a href="ch103-02-03-testing-components.html"><strong aria-hidden="true">17.2.3.</strong> Testing Components</a></li></ol></li><li class="chapter-item expanded "><a href="ch103-03-upgradeability.html"><strong aria-hidden="true">17.3.</strong> Upgradeability</a></li><li class="chapter-item expanded "><a href="ch103-04-L1-L2-messaging.html"><strong aria-hidden="true">17.4.</strong> L1 &lt;&gt; L2 Messaging</a></li><li class="chapter-item expanded "><a href="ch103-05-oracle-interactions.html"><strong aria-hidden="true">17.5.</strong> Oracle Interactions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch103-05-01-price-feeds.html"><strong aria-hidden="true">17.5.1.</strong> Price Feeds</a></li><li class="chapter-item "><a href="ch103-05-02-randomness.html"><strong aria-hidden="true">17.5.2.</strong> Randomness</a></li></ol></li><li class="chapter-item expanded "><a href="ch103-06-00-other-examples.html"><strong aria-hidden="true">17.6.</strong> Other Examples</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch103-06-01-deploying-and-interacting-with-a-voting-contract.html"><strong aria-hidden="true">17.6.1.</strong> Deploying and Interacting with a Voting Contract</a></li><li class="chapter-item "><a href="ch103-06-02-working-with-erc20-token.html"><strong aria-hidden="true">17.6.2.</strong> Working with ERC20 Token</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="ch104-00-starknet-smart-contracts-security.html"><strong aria-hidden="true">18.</strong> Starknet Smart Contracts Security</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch104-01-general-recommendations.html"><strong aria-hidden="true">18.1.</strong> General Recommendations</a></li><li class="chapter-item expanded "><a href="ch104-02-testing-smart-contracts.html"><strong aria-hidden="true">18.2.</strong> Testing Smart Contracts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch104-02-01-unit-testing.html"><strong aria-hidden="true">18.2.1.</strong> Unit Testing</a></li><li class="chapter-item "><a href="ch104-02-02-integration-testing.html"><strong aria-hidden="true">18.2.2.</strong> Integration Testing</a></li><li class="chapter-item "><a href="ch104-02-03-fuzz-testing.html"><strong aria-hidden="true">18.2.3.</strong> Property-Based Testing</a></li><li class="chapter-item "><a href="ch104-02-04-fork-testing.html"><strong aria-hidden="true">18.2.4.</strong> Fork Testing</a></li></ol></li><li class="chapter-item expanded "><a href="ch104-03-static-analysis-tools.html"><strong aria-hidden="true">18.3.</strong> Static Analysis Tools</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-000.html"><strong aria-hidden="true">19.</strong> Appendix (Starknet)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-08-system-calls.html"><strong aria-hidden="true">19.1.</strong> A - System Calls</a></li><li class="chapter-item expanded "><a href="appendix-09-sierra.html"><strong aria-hidden="true">19.2.</strong> B - Sierra</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Cairo VM</li><li class="chapter-item expanded "><a href="ch200-introduction.html"><strong aria-hidden="true">20.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="ch201-architecture.html"><strong aria-hidden="true">21.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="ch202-00-memory.html"><strong aria-hidden="true">22.</strong> Memory</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch202-01-non-deterministic-read-only-memory.html"><strong aria-hidden="true">22.1.</strong> Non-Deterministic Read-only Memory</a></li><li class="chapter-item expanded "><a href="ch202-02-segments.html"><strong aria-hidden="true">22.2.</strong> Segments and Relocation</a></li></ol></li><li class="chapter-item expanded "><a href="ch203-00-execution-model.html"><strong aria-hidden="true">23.</strong> Execution Model</a></li><li class="chapter-item expanded "><a href="ch204-00-builtins.html"><strong aria-hidden="true">24.</strong> Builtins</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch204-01-how-builtins-work.html"><strong aria-hidden="true">24.1.</strong> How Builtins Work</a></li><li class="chapter-item expanded "><a href="ch204-02-builtins-list.html"><strong aria-hidden="true">24.2.</strong> Builtins List</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ch204-02-00-output.html"><strong aria-hidden="true">24.2.1.</strong> Output</a></li><li class="chapter-item "><a href="ch204-02-01-pedersen.html"><strong aria-hidden="true">24.2.2.</strong> Pedersen</a></li><li class="chapter-item "><a href="ch204-02-02-range-check.html"><strong aria-hidden="true">24.2.3.</strong> Range Check</a></li><li class="chapter-item "><a href="ch204-02-03-ecdsa.html"><strong aria-hidden="true">24.2.4.</strong> ECDSA</a></li><li class="chapter-item "><a href="ch204-02-04-bitwise.html"><strong aria-hidden="true">24.2.5.</strong> Bitwise</a></li><li class="chapter-item "><a href="ch204-02-05-ec-op.html"><strong aria-hidden="true">24.2.6.</strong> EC OP</a></li><li class="chapter-item "><a href="ch204-02-06-keccak.html"><strong aria-hidden="true">24.2.7.</strong> Keccak</a></li><li class="chapter-item "><a href="ch204-02-07-poseidon.html"><strong aria-hidden="true">24.2.8.</strong> Poseidon</a></li><li class="chapter-item "><a href="ch204-02-08-mod-builtin.html"><strong aria-hidden="true">24.2.9.</strong> Mod Builtin</a></li><li class="chapter-item "><a href="ch204-02-11-segment-arena.html"><strong aria-hidden="true">24.2.10.</strong> Segment Arena</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="ch205-00-hints.html"><strong aria-hidden="true">25.</strong> Hints</a></li><li class="chapter-item expanded "><a href="ch206-00-runner.html"><strong aria-hidden="true">26.</strong> Runner</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">26.1.</strong> Program</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">26.1.1.</strong> Program Artifacts</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.1.2.</strong> Program Parsing</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">26.2.</strong> Runner Mode</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">26.2.1.</strong> Execution Mode</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.2.2.</strong> Proof Mode</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">26.3.</strong> Output</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">26.3.1.</strong> Cairo PIE</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.3.2.</strong> Memory File</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.3.3.</strong> Trace file</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.3.4.</strong> AIR public input</div></li><li class="chapter-item "><div><strong aria-hidden="true">26.3.5.</strong> AIR private input</div></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">27.</strong> Tracer</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">28.</strong> Implementations</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">29.</strong> Resources</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                            aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                            aria-label="Change theme" aria-haspopup="true" aria-expanded="false"
                            aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Cairo Programming Language</h1>


                    <div class="right-buttons">
                        <div class="menu-cairo-home-wrapper">
                            <a href="https://cairo-lang.org" class="menu-cairo-home" title="Cairo Home"
                                aria-label="Cairo Home">
                                <img src="/icons/Cairo_logo_500x500.png" alt="Cairo Logo"
                                    class="cairo-logo">
                                <span class="menu-cairo-home-text">Cairo Home</span>
                            </a>
                        </div>
                        <div class="menu-cairo-home-wrapper">
                            <a href="https://starknet.io" class="menu-cairo-home" title="Starknet" aria-label="Starknet">
                                <img src="/icons/SN_logo.png" alt="Starknet Logo"
                                    class="cairo-logo">
                                <span class="menu-cairo-home-text">Starknet</span>
                            </a>
                        </div>
                        <button id="language-toggle" class="icon-button" type="button" title="Change language"
                            aria-label="Change language" aria-haspopup="true" aria-expanded="false"
                            aria-controls="language-list">
                            <i class="fa fa-globe"></i>
                        </button>
                        <ul id="language-list" class="theme-popup" aria-label="Languages" role="menu">
                            <li role="none"><button role="menuitem" class="theme">
                                    <a id="en">English</a>
                                </button></li>
                        </ul>
                        <script>
                            let langToggle = document.getElementById("language-toggle");
                            let langList = document.getElementById("language-list");
                            langToggle.addEventListener("click", (event) => {
                                langList.style.display = langList.style.display == "block" ? "none" : "block";
                            });
                            let selectedLang = document.getElementById("id");
                            selectedLang.parentNode.classList.add("theme-selected");

                            // The path to the root, taking the current
                            // language into account.
                            { { #if(eq language "en") } }
                            let full_path_to_root = "";
                            { {else } }
                            let full_path_to_root = "../";
                            { {/if } }
                            // The page path (mdbook only gives us
                            // access to the path to the Markdown file).
                            let path = "ch104-02-04-fork-testing.md".replace(/\.md$/, ".html");
                            for (let lang of langList.querySelectorAll("a")) {
                                if (lang.id == "en") {
                                    lang.href = `${full_path_to_root}${path}`;
                                } else {
                                    lang.href = `${full_path_to_root}${lang.id}/${path}`;
                                }
                            }
                        </script>

                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cairo-book/cairo-book.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/cairo-book/cairo-book.github.io/edit/main/src/ch104-02-04-fork-testing.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                            aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="fork-testing"><a class="header" href="#fork-testing">Fork Testing</a></h1>
<p>Fork testing runs your tests against actual blockchain state. Instead of
deploying mock contracts, you interact with real deployed protocols like DEXs,
oracles, and lending platforms as they exist on mainnet or testnet.</p>
<p>This comes with trade-offs. Fork tests are slower, require RPC access, and can
be non-deterministic. Use them for scenarios where mocks aren't sufficient.</p>
<h2 id="when-to-use-fork-testing"><a class="header" href="#when-to-use-fork-testing">When to Use Fork Testing</a></h2>
<p>Fork testing works well in specific scenarios:</p>
<div class="table-wrapper"><table><thead><tr><th>Good Fit</th><th>Why</th></tr></thead><tbody>
<tr><td>Integration with deployed protocols</td><td>Test against actual DEX, oracle, or lending behavior</td></tr>
<tr><td>Reproducing mainnet bugs</td><td>Pin to the exact block where a bug occurred</td></tr>
<tr><td>Upgrade testing</td><td>Verify upgrades against real storage state</td></tr>
<tr><td>Composability testing</td><td>Test complex multi-protocol interactions</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th>Poor Fit</th><th>Why</th></tr></thead><tbody>
<tr><td>Unit tests</td><td>Way too slow for isolated logic</td></tr>
<tr><td>Fuzz testing</td><td>Burns RPC quota quickly</td></tr>
<tr><td>Rapid development iteration</td><td>Latency kills feedback loop</td></tr>
<tr><td>Testing isolated contract logic</td><td>No benefit over regular tests</td></tr>
</tbody></table>
</div>
<p>If your contract doesn't interact with deployed protocols, you probably don't
need fork testing.</p>
<h2 id="configuring-fork-testing"><a class="header" href="#configuring-fork-testing">Configuring Fork Testing</a></h2>
<p>Configure fork targets in your <code>Scarb.toml</code>:</p>
<pre><code class="language-toml">[[tool.snforge.fork]]
name = "MAINNET"
url = "https://starknet-mainnet.public.blastapi.io/rpc/v0_7"
block_id.number = "500000"

[[tool.snforge.fork]]
name = "SEPOLIA"
url = "https://starknet-sepolia.public.blastapi.io/rpc/v0_7"
block_id.number = "100000"
</code></pre>
<p>Then use the <code>#[fork]</code> attribute in your tests:</p>
<pre><code class="language-cairo noplayground">#[test]
#[fork("MAINNET")]
fn test_integration_with_deployed_protocol() {
    // This test runs against mainnet state at block 500000
}
</code></pre>
<h2 id="block-pinning"><a class="header" href="#block-pinning">Block Pinning</a></h2>
<p>If you take one thing from this page: <em>pin your blocks</em>. Without pinning, your
tests are non-deterministic. They pass today, fail tomorrow, as chain state
changes.</p>
<h3 id="pinning-strategies"><a class="header" href="#pinning-strategies">Pinning Strategies</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Strategy</th><th>Determinism</th><th>Use Case</th></tr></thead><tbody>
<tr><td><code>block_id.number</code></td><td>✅ Deterministic</td><td>CI, reproducible tests</td></tr>
<tr><td><code>block_id.hash</code></td><td>✅ Deterministic</td><td>Pin to specific state</td></tr>
<tr><td><code>block_id.tag = "latest"</code></td><td>❌ Non-deterministic</td><td>Manual exploration only</td></tr>
</tbody></table>
</div>
<p>Always pin to a specific block number in CI. Using <code>latest</code> causes flaky tests
that fail randomly as chain state evolves.</p>
<pre><code class="language-toml"># Good - deterministic
[[tool.snforge.fork]]
name = "MAINNET_PINNED"
url = "https://your-rpc-url.com"
block_id.number = "500000"

# Bad for CI - non-deterministic
[[tool.snforge.fork]]
name = "MAINNET_LATEST"
url = "https://your-rpc-url.com"
block_id.tag = "latest"
</code></pre>
<h2 id="practical-example-testing-against-a-deployed-contract"><a class="header" href="#practical-example-testing-against-a-deployed-contract">Practical Example: Testing Against a Deployed Contract</a></h2>
<p>First, define an interface matching the deployed contract you want to interact
with:</p>
<pre><code class="language-cairo noplayground"><span class="boring">// TAG: does_not_run
</span>// Interface matching a deployed protocol (e.g., an oracle or DEX)
#[starknet::interface]
pub trait IDeployedProtocol&lt;TContractState&gt; {
    fn get_price(self: @TContractState, token: starknet::ContractAddress) -&gt; u256;
    fn get_reserve(self: @TContractState) -&gt; u256;
}
<span class="boring">
</span><span class="boring">// Your contract that will interact with deployed protocols
</span><span class="boring">#[starknet::interface]
</span><span class="boring">pub trait IMyContract&lt;TContractState&gt; {
</span><span class="boring">    fn set_oracle(ref self: TContractState, oracle: starknet::ContractAddress);
</span><span class="boring">    fn get_token_value(
</span><span class="boring">        self: @TContractState, token: starknet::ContractAddress, amount: u256,
</span><span class="boring">    ) -&gt; u256;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[starknet::contract]
</span><span class="boring">pub mod MyContract {
</span><span class="boring">    use starknet::ContractAddress;
</span><span class="boring">    use starknet::storage::{StoragePointerReadAccess, StoragePointerWriteAccess};
</span><span class="boring">    use super::{IDeployedProtocolDispatcher, IDeployedProtocolDispatcherTrait};
</span><span class="boring">
</span><span class="boring">    #[storage]
</span><span class="boring">    struct Storage {
</span><span class="boring">        oracle: IDeployedProtocolDispatcher,
</span><span class="boring">    }
</span><span class="boring">
</span><span class="boring">    #[abi(embed_v0)]
</span><span class="boring">    impl MyContractImpl of super::IMyContract&lt;ContractState&gt; {
</span><span class="boring">        fn set_oracle(ref self: ContractState, oracle: ContractAddress) {
</span><span class="boring">            self.oracle.write(IDeployedProtocolDispatcher { contract_address: oracle });
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        fn get_token_value(self: @ContractState, token: ContractAddress, amount: u256) -&gt; u256 {
</span><span class="boring">            let price = self.oracle.read().get_price(token);
</span><span class="boring">            amount * price
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">#[cfg(test)]
</span><span class="boring">mod tests;
</span></code></pre>
<p>Then write a fork test that interacts with the real deployed contract:</p>
<pre><code class="language-cairo noplayground"><span class="boring">// Fork testing examples
</span><span class="boring">// NOTE: These tests require RPC access and are marked with #[ignore]
</span><span class="boring">// to prevent CI failures. Run locally with: snforge test --ignored
</span><span class="boring">
</span><span class="boring">use snforge_std::{ContractClassTrait, DeclareResultTrait, declare};
</span><span class="boring">use starknet::ContractAddress;
</span><span class="boring">use super::{
</span><span class="boring">    IDeployedProtocolDispatcher, IDeployedProtocolDispatcherTrait, IMyContractDispatcher,
</span><span class="boring">    IMyContractDispatcherTrait,
</span><span class="boring">};
</span><span class="boring">
</span>// For example only - replace addresses with real deployed contracts
#[test]
#[fork("MAINNET")]
#[ignore] // Requires RPC access - run with: snforge test --ignored
fn test_reads_from_deployed_protocol() {
    // Replace 0x123 with an actual deployed contract address (e.g., Pragma oracle)
    let oracle_address: ContractAddress = 0x123.try_into().unwrap();
    let token_address: ContractAddress = 0x456.try_into().unwrap();

    // Create dispatcher to interact with deployed contract
    let oracle = IDeployedProtocolDispatcher { contract_address: oracle_address };

    // Call the real deployed contract - reads actual on-chain state
    let price = oracle.get_price(token_address);

    // Assert on actual mainnet data
    assert!(price &gt; 0, "Price should be positive");
}
<span class="boring">
</span><span class="boring">// For example only - replace addresses with real deployed contracts
</span><span class="boring">#[test]
</span><span class="boring">#[fork("MAINNET")]
</span><span class="boring">#[ignore] // Requires RPC access
</span><span class="boring">fn test_my_contract_with_deployed_oracle() {
</span><span class="boring">    // Deploy your contract in the forked environment
</span><span class="boring">    let contract_class = declare("MyContract").unwrap().contract_class();
</span><span class="boring">    let (contract_address, _) = contract_class.deploy(@array![]).unwrap();
</span><span class="boring">    let my_contract = IMyContractDispatcher { contract_address };
</span><span class="boring">
</span><span class="boring">    // Replace 0x123 with actual Pragma oracle address on mainnet
</span><span class="boring">    let oracle_address: ContractAddress = 0x123.try_into().unwrap();
</span><span class="boring">    my_contract.set_oracle(oracle_address);
</span><span class="boring">
</span><span class="boring">    // Your contract now interacts with the real oracle
</span><span class="boring">    let token: ContractAddress = 0x456.try_into().unwrap();
</span><span class="boring">    let value = my_contract.get_token_value(token, 100);
</span><span class="boring">
</span><span class="boring">    // Verify the integration works with real protocol behavior
</span><span class="boring">    assert!(value &gt; 0, "Value should be positive based on real oracle price");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">// For example only - demonstrates testing against historical state
</span><span class="boring">#[test]
</span><span class="boring">#[fork("MAINNET")]
</span><span class="boring">#[ignore] // Requires RPC access
</span><span class="boring">fn test_historical_state() {
</span><span class="boring">    // At block 500000, we know certain conditions existed
</span><span class="boring">    // Useful for: reproducing bugs, testing known market conditions,
</span><span class="boring">    // verifying behavior with historical data
</span><span class="boring">
</span><span class="boring">    // Replace with actual contract address
</span><span class="boring">    let oracle_address: ContractAddress = 0x123.try_into().unwrap();
</span><span class="boring">    let oracle = IDeployedProtocolDispatcher { contract_address: oracle_address };
</span><span class="boring">
</span><span class="boring">    // Read state at this historical block
</span><span class="boring">    let reserve = oracle.get_reserve();
</span><span class="boring">
</span><span class="boring">    // Assert on known historical state
</span><span class="boring">    assert!(reserve &gt; 0, "Reserve should exist at this block");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">
</span></code></pre>
<h3 id="testing-your-contract-against-deployed-protocols"><a class="header" href="#testing-your-contract-against-deployed-protocols">Testing Your Contract Against Deployed Protocols</a></h3>
<p>More commonly, you'll deploy your contract in the fork and have it interact with
deployed protocols:</p>
<pre><code class="language-cairo noplayground"><span class="boring">// Fork testing examples
</span><span class="boring">// NOTE: These tests require RPC access and are marked with #[ignore]
</span><span class="boring">// to prevent CI failures. Run locally with: snforge test --ignored
</span><span class="boring">
</span><span class="boring">use snforge_std::{ContractClassTrait, DeclareResultTrait, declare};
</span><span class="boring">use starknet::ContractAddress;
</span><span class="boring">use super::{
</span><span class="boring">    IDeployedProtocolDispatcher, IDeployedProtocolDispatcherTrait, IMyContractDispatcher,
</span><span class="boring">    IMyContractDispatcherTrait,
</span><span class="boring">};
</span><span class="boring">
</span><span class="boring">// For example only - replace addresses with real deployed contracts
</span><span class="boring">#[test]
</span><span class="boring">#[fork("MAINNET")]
</span><span class="boring">#[ignore] // Requires RPC access - run with: snforge test --ignored
</span><span class="boring">fn test_reads_from_deployed_protocol() {
</span><span class="boring">    // Replace 0x123 with an actual deployed contract address (e.g., Pragma oracle)
</span><span class="boring">    let oracle_address: ContractAddress = 0x123.try_into().unwrap();
</span><span class="boring">    let token_address: ContractAddress = 0x456.try_into().unwrap();
</span><span class="boring">
</span><span class="boring">    // Create dispatcher to interact with deployed contract
</span><span class="boring">    let oracle = IDeployedProtocolDispatcher { contract_address: oracle_address };
</span><span class="boring">
</span><span class="boring">    // Call the real deployed contract - reads actual on-chain state
</span><span class="boring">    let price = oracle.get_price(token_address);
</span><span class="boring">
</span><span class="boring">    // Assert on actual mainnet data
</span><span class="boring">    assert!(price &gt; 0, "Price should be positive");
</span><span class="boring">}
</span><span class="boring">
</span>// For example only - replace addresses with real deployed contracts
#[test]
#[fork("MAINNET")]
#[ignore] // Requires RPC access
fn test_my_contract_with_deployed_oracle() {
    // Deploy your contract in the forked environment
    let contract_class = declare("MyContract").unwrap().contract_class();
    let (contract_address, _) = contract_class.deploy(@array![]).unwrap();
    let my_contract = IMyContractDispatcher { contract_address };

    // Replace 0x123 with actual Pragma oracle address on mainnet
    let oracle_address: ContractAddress = 0x123.try_into().unwrap();
    my_contract.set_oracle(oracle_address);

    // Your contract now interacts with the real oracle
    let token: ContractAddress = 0x456.try_into().unwrap();
    let value = my_contract.get_token_value(token, 100);

    // Verify the integration works with real protocol behavior
    assert!(value &gt; 0, "Value should be positive based on real oracle price");
}
<span class="boring">
</span><span class="boring">// For example only - demonstrates testing against historical state
</span><span class="boring">#[test]
</span><span class="boring">#[fork("MAINNET")]
</span><span class="boring">#[ignore] // Requires RPC access
</span><span class="boring">fn test_historical_state() {
</span><span class="boring">    // At block 500000, we know certain conditions existed
</span><span class="boring">    // Useful for: reproducing bugs, testing known market conditions,
</span><span class="boring">    // verifying behavior with historical data
</span><span class="boring">
</span><span class="boring">    // Replace with actual contract address
</span><span class="boring">    let oracle_address: ContractAddress = 0x123.try_into().unwrap();
</span><span class="boring">    let oracle = IDeployedProtocolDispatcher { contract_address: oracle_address };
</span><span class="boring">
</span><span class="boring">    // Read state at this historical block
</span><span class="boring">    let reserve = oracle.get_reserve();
</span><span class="boring">
</span><span class="boring">    // Assert on known historical state
</span><span class="boring">    assert!(reserve &gt; 0, "Reserve should exist at this block");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">
</span></code></pre>
<h2 id="caching-and-performance"><a class="header" href="#caching-and-performance">Caching and Performance</a></h2>
<p>Fork tests are slow on first run—Starknet Foundry has to fetch state from the
RPC. After that, it caches.</p>
<p>Expect 1-7 minutes on a cold cache depending on how much state you touch.
Subsequent runs take seconds.</p>
<h3 id="cache-behavior"><a class="header" href="#cache-behavior">Cache Behavior</a></h3>
<p>Cache is keyed by RPC URL and block number, so changing block number invalidates
cache. Cache persists across test runs.</p>
<p>To reset the cache (useful when debugging):</p>
<pre><code class="language-bash">rm -rf ~/.blockchain_cache
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="use-fork-tests-sparingly"><a class="header" href="#use-fork-tests-sparingly">Use Fork Tests Sparingly</a></h3>
<p>Fork tests should be at the top of your testing pyramid:</p>
<pre><code class="language-text">        △
       /  \      Fork Tests (few)
      /----\     Integration Tests (some)
     /------\    Unit Tests (most)
    ▔▔▔▔▔▔▔▔▔▔
</code></pre>
<p>Don't use fork tests for logic that can be tested with unit tests or integration
tests.</p>
<h3 id="pin-blocks-for-ci"><a class="header" href="#pin-blocks-for-ci">Pin Blocks for CI</a></h3>
<p>Your CI should use deterministic block numbers:</p>
<pre><code class="language-toml">[[tool.snforge.fork]]
name = "MAINNET_CI"
url = "https://your-rpc-url.com"
block_id.number = "500000"  # Fixed block for reproducibility
</code></pre>
<h3 id="document-why-youre-forking"><a class="header" href="#document-why-youre-forking">Document Why You're Forking</a></h3>
<p>Fork tests should have comments explaining what deployed contract you're testing
against and why a mock wouldn't work:</p>
<pre><code class="language-cairo noplayground">#[test]
#[fork("MAINNET")]
fn test_complex_dex_routing() {
    // We fork mainnet because:
    // 1. DEX router at 0xABC has complex multi-hop logic
    // 2. Actual liquidity pools affect routing decisions
    // 3. Mocking this would be as complex as the real thing
    // ...
}
</code></pre>
<h3 id="test-both-success-and-failure"><a class="header" href="#test-both-success-and-failure">Test Both Success and Failure</a></h3>
<p>Fork tests should verify your contract handles real-world conditions:</p>
<pre><code class="language-cairo noplayground">#[test]
#[fork("MAINNET")]
fn test_handles_low_liquidity() {
    // Test against a pool with known low liquidity
    // Verify your contract handles slippage correctly
}

#[test]
#[fork("MAINNET")]
fn test_handles_oracle_stale_price() {
    // Test against historical block where oracle was stale
    // Verify your contract's staleness check works
}
</code></pre>
<h2 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h2>
<ul>
<li>
<p><strong>Non-deterministic tests</strong>: If your tests pass sometimes and fail other
times, you're probably using <code>block_id.tag = "latest"</code> or not pinning at all.
Always pin to a specific block number.</p>
</li>
<li>
<p><strong>RPC quota exhaustion</strong>: If tests fail with RPC errors, you may have too many
fork tests, or you're combining fork with fuzzing. Use a dedicated RPC
provider, reduce fork test count, run fork tests in a separate CI job, cache
aggressively, and never fuzz with fork.</p>
</li>
<li>
<p><strong>Slow feedback loop</strong>: If fork tests take minutes to run, you likely have a
cold cache or excessive state access. Warm the cache in CI setup and minimize
state reads.</p>
</li>
</ul>
<h2 id="when-fork-testing-isnt-enough"><a class="header" href="#when-fork-testing-isnt-enough">When Fork Testing Isn't Enough</a></h2>
<p>Fork testing has limitations. You can't test future state, only historical data.
Deployed contracts might change, so you can't test protocol upgrades. And
interactions affect real state, so you can't test in isolation.</p>
<p>For thorough coverage, combine fork testing with unit tests for logic,
integration tests for your contract's interface, and fuzz tests for edge cases.</p>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Fork testing lets you test against real blockchain state. Use it for deployed
protocol integrations, reproducing bugs, and upgrade testing. Don't use it for
unit tests, fuzz tests, or rapid iteration. Always pin to a specific block for
deterministic CI, and keep fork tests minimal—only where mocks aren't
sufficient.</p>
<p>For detailed configuration options, see the
<a href="https://foundry-rs.github.io/starknet-foundry/snforge-advanced-features/fork-testing.html">Starknet Foundry fork testing documentation</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <a rel="prev" href="ch104-02-03-fuzz-testing.html" class="mobile-nav-chapters previous"
                            title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                            <i class="fa fa-angle-left"></i>
                        </a>

                        <a rel="next" href="ch104-03-static-analysis-tools.html" class="mobile-nav-chapters next"
                            title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                            <i class="fa fa-angle-right"></i>
                        </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                <a rel="prev" href="ch104-02-03-fuzz-testing.html" class="nav-chapters previous" title="Previous chapter"
                    aria-label="Previous chapter" aria-keyshortcuts="Left">
                    <i class="fa fa-angle-left"></i>
                </a>

                <a rel="next" href="ch104-03-static-analysis-tools.html" class="nav-chapters next" title="Next chapter"
                    aria-label="Next chapter" aria-keyshortcuts="Right">
                    <i class="fa fa-angle-right"></i>
                </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>

        <!-- Cairo WASM compiler for in-browser code execution (runs in Web Worker) -->
        <script>
            (function () {
                var rootPath = "";
                var workerUrl = "./" + rootPath + "wasm/cairo_worker.js";
                var worker = new Worker(workerUrl, { type: "module" });
                var nextId = 0;
                var pending = {};

                worker.onmessage = function (e) {
                    if (e.data.type === "ready") {
                        window.cairoWasmReady = true;
                        console.log("Cairo WASM worker initialized");
                        return;
                    }
                    if (e.data.type === "result") {
                        var cb = pending[e.data.id];
                        if (cb) {
                            delete pending[e.data.id];
                            if (e.data.error) {
                                cb.reject(new Error(e.data.error));
                            } else {
                                cb.resolve(e.data.response);
                            }
                        }
                    }
                };

                window.cairoWasm = {
                    compile_and_run: function (requestJson) {
                        var id = nextId++;
                        return new Promise(function (resolve, reject) {
                            pending[id] = { resolve: resolve, reject: reject };
                            worker.postMessage({ type: "run", id: id, request: JSON.parse(requestJson) });
                        });
                    }
                };
            })();
        </script>

        <script src="book.js"></script>
        <script>
            window.rootPath = "";
        </script>

        <!-- Custom JS scripts -->
        <script src="theme/chat.js"></script>
        <script src="theme/js/version-switcher.js"></script>


    </div>
</body>

</html>
